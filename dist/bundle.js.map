{"version":3,"sources":["webpack://bookmarker/./js/store.js","webpack://bookmarker/./js/render.js","webpack://bookmarker/./js/event.js","webpack://bookmarker/./js/index.js"],"names":["getStorageData","key","Promise","resolve","reject","chrome","storage","sync","get","result","runtime","lastError","Error","message","async","createCollect","data","storageData","JSON","stringify","html","children","url","title","search","length","item","renderFavorite","res","collect","document","getElementById","innerHTML","createFavorite","set","renderCollect","sendMessage","response","parse","main","folderList","body","appendChild","handleCollect","e","target","dataset","push","initBookmarkListener","stopPropagation","handleDelCollect","forEach","index","splice","handleJump","currentTarget","window","open","handleCollapse","curUl","parentNode","querySelector","style","display","classList","toggle","switchTabTo","value","switchMode","modeData","mode","setAttribute","Array","from","querySelectorAll","addEventListener","initAllListener","onkeypress","which","obj","selectedIndex","options","inputValue","console","log"],"mappings":"mBAGO,MAAMA,EAAkBC,GAC7B,IAAIC,SAAQ,CAACC,EAASC,IACpBC,OAAOC,QAAQC,KAAKC,IAAIP,GAAMQ,GAC5BJ,OAAOK,QAAQC,UACXP,EAAOQ,MAAMP,OAAOK,QAAQC,UAAUE,UACtCV,EAAQM,OCNlBK,eAAeC,EAAcC,GAC3B,IAAIC,QAAoBjB,EAAe,WACvCiB,EAAcC,KAAKC,UAAUF,GAC7B,IAAIG,EAAO,GACX,IAAKJ,EAAKK,SAiCR,OAhCAD,GAAQ,qCAAqCJ,EAAKM,oBAAoBN,EAAKO,UAC3EH,GAAQ,6HAG6BJ,EAAKM,oBACxCN,EAAKO,gBAE6B,IAAlCN,EAAYO,OAAOR,EAAKM,KACpB,qBACA,0IAIIN,EAAKM,mDAEeN,EAAKO,8FAGzBP,EAAKM,+EAGgC,IAAlCL,EAAYO,OAAOR,EAAKM,KAAc,MAAQ,4CAEf,IAAlCL,EAAYO,OAAOR,EAAKM,KAAc,eAAiB,iBAC1CN,EAAKM,oBAAoBN,EAAKO,gBACjB,IAAlCN,EAAYO,OAAOR,EAAKM,KACpB,oBACA,2EAKCF,EAST,GAPAA,EAAO,4JAGwBJ,EAAKO,wEAIhCP,EAAKK,SAASI,OAChB,IAAK,IAAIC,KAAQV,EAAKK,SACfK,EAAKL,WACRD,SAAcL,EAAcW,SAIhCN,GAAQ,kGAMVA,GAAQ,cACR,IAAK,IAAIM,KAAQV,EAAKK,SAChBK,EAAKL,WACPD,SAAcL,EAAcW,IAGhC,OAAON,EA8CF,MAAMO,EAAiBb,UAC5B,IAAIc,QAAY5B,EAAe,WAC3B4B,EAAIC,QA5CV,SAAwBb,GACtB,IAAII,EAAO,wLAMX,GAAIJ,EAAKS,OAAS,EAChB,IAAK,IAAIC,KAAQV,EACfI,GAAQ,6CAC4BM,EAAKJ,8UAMmBI,EAAKJ,mDACrCI,EAAKH,8FAGzBG,EAAKJ,wIAIgCI,EAAKJ,kFAMpDF,GAAQ,kGAMVA,GAAQ,cACQU,SAASC,eAAe,WAC9BC,UAAYZ,EAOpBa,CAAeL,EAAIC,SAEnBxB,OAAOC,QAAQC,KAAK2B,IAAI,CAAEL,QAAS,MAK1BM,EAAgB,IAC3B,IAAIjC,SAAS,CAACC,EAASC,KAErBC,OAAOK,QAAQ0B,YAAY,IAAItB,eAAgBuB,GAC7C,IAAIrB,EAAOE,KAAKoB,MAAMD,GAClBE,EAAOT,SAASC,eAAe,YACnCQ,EAAKP,UAAY,GACjB,IAAIQ,EAAaxB,EAAK,GAAGK,SACzB,IAAK,IAAIK,KAAQc,EACfD,EAAKP,iBAAmBjB,EAAcW,GAExCI,SAASW,KAAKC,YAAYH,GAC1BpC,UCrIN,SAASwC,EAAcC,GACrB,MAAM,IAAEtB,EAAG,MAAEC,GAAUqB,EAAEC,OAAOC,QAChCzC,OAAOC,QAAQC,KAAKC,IAAI,WAAYoB,IAClC,IAAIZ,EAAOE,KAAKoB,MAAMpB,KAAKC,UAAUS,EAAIC,UACzCb,EAAK+B,KAAK,CAAEzB,MAAKC,UACjBlB,OAAOC,QAAQC,KAAK2B,IAAI,CAAEL,QAASb,IACnCW,IACAQ,IACAa,OAEFJ,EAAEK,kBAGJ,SAASC,EAAiBN,GACxB,MAAM,IAAEtB,GAAQsB,EAAEC,OAAOC,QACzBzC,OAAOC,QAAQC,KAAKC,IAAI,WAAYoB,IAClC,IAAIZ,EAAOE,KAAKoB,MAAMpB,KAAKC,UAAUS,EAAIC,UACzCb,EAAKmC,SAAQ,CAACzB,EAAM0B,KACd1B,EAAKJ,MAAQA,GACfN,EAAKqC,OAAOD,EAAO,MAGvB/C,OAAOC,QAAQC,KAAK2B,IAAI,CAAEL,QAASb,IACnCW,IACAQ,OAEFS,EAAEK,kBAGJ,SAASK,EAAWV,GAClB,IAAItB,EAAMsB,EAAEW,cAAcT,QAAQxB,IAC9BA,GACFkC,OAAOC,KAAKnC,EAAK,UAIrB,SAASoC,EAAed,GACtB,IACIe,EADYf,EAAEW,cAAcK,WACVC,cAAc,MACpCF,EAAMG,MAAMC,QAAiC,QAAvBJ,EAAMG,MAAMC,QAAoB,OAAS,OACpDnB,EAAEC,OAAOgB,cAAc,iBAC7BG,UAAUC,OAAO,qBA6BxB,SAASC,EAAYtB,GACnB,IAAI,MAAEuB,GAAUvB,EAAEW,cAAcT,QAChC,OAAQqB,GACN,IAAK,QACHC,EAAW,SACX,MACF,IAAK,OACHA,EAAW,QACX,MACF,IAAK,OACHA,EAAW,SAMjB,SAASA,EAAWC,GAClBhE,OAAOC,QAAQC,KAAK2B,IAAI,CAAEoC,KAAMD,IAChCvC,SAAS+B,cAAc,QAAQU,aAAa,aAAcF,GAIrD,MAGMrB,EAAuB,WAClCwB,MAAMC,KAAK3C,SAAS4C,iBAAiB,qBAAqBvB,SAASP,IACjEA,EAAE+B,iBAAiB,QAASjB,MAE9Bc,MAAMC,KAAK3C,SAAS4C,iBAAiB,iBAAiBvB,SAASP,IAC7DA,EAAE+B,iBAAiB,QAASrB,MAE9BkB,MAAMC,KAAK3C,SAAS4C,iBAAiB,kBAAkBvB,SAASP,IAC9DA,EAAE+B,iBAAiB,QAAShC,MAE9B6B,MAAMC,KAAK3C,SAAS4C,iBAAiB,cAAcvB,SAASP,IAC1DA,EAAE+B,iBAAiB,QAASzB,OAyBnB0B,EAAkB,WAE7B5B,IArBAlB,SAAS+B,cAAc,SAASgB,WAAcjC,KAnEhD,SAAgBA,GACd,GAAgB,KAAZA,EAAEkC,MAAc,CAClB,IAAIC,EAAMjD,SAAS4C,iBAAiB,kBAAkB,GAClDtB,EAAQ2B,EAAIC,cACZb,EAAQY,EAAIE,QAAQ7B,GAAOe,MAC/B,MAAMe,EAAatC,EAAEC,OAAOsB,MAC5B,IAAI7C,EAAM,GACV,OAAQ6C,GACN,IAAK,QACH7C,EAAM,0BACN,MACF,IAAK,SACHA,EAAM,mCACN,MACF,IAAK,OACHA,EAAM,iCACN,MACF,IAAK,SACHA,EAAM,mCAGVkC,OAAOC,KAAK,GAAGnC,IAAM4D,IAAc,WA+CnC1D,CAAOoB,IAMT4B,MAAMC,KAAK3C,SAAS4C,iBAAiB,gBAAgBvB,SAASP,IAC5DA,EAAE+B,iBAAiB,QAAST,MAE9BpC,SAAS+B,cAAc,cAAcc,iBAAiB,SAAU/B,IAC9Dd,SAAS+B,cAAc,cAAcG,UAAUC,OAAO,gBAExDO,MAAMC,KAAK3C,SAAS4C,iBAAiB,mBAAmBvB,SAASP,IAC/DA,EAAE+B,iBAAiB,QAAST,QCtGhCpD,uBACQqB,UACAR,IACNiD,IAxBAvE,OAAOC,QAAQC,KAAKC,IAAI,QAAQoB,IAC9B,MAAM,KAAC0C,GAAQ1C,EACfuD,QAAQC,IAAId,GAWRA,IACFjE,OAAOC,QAAQC,KAAK2B,IAAI,CAAC,KAAQ,SACjCoC,EAAO,QAETxC,SAAS+B,cAAc,QAAQU,aAAa,aAAcD,MAW9D/B,I","file":"bundle.js","sourcesContent":["let storageData = null\n\n// 取\nexport const getStorageData = (key) =>\n  new Promise((resolve, reject) =>\n    chrome.storage.sync.get(key, (result) =>\n      chrome.runtime.lastError\n        ? reject(Error(chrome.runtime.lastError.message))\n        : resolve(result)\n    )\n  )\n\n// 存\nexport const setStorageData = (data) =>\n  new Promise((resolve, reject) =>\n    chrome.storage.sync.set(data, () =>\n      chrome.runtime.lastError\n        ? reject(Error(chrome.runtime.lastError.message))\n        : resolve()\n    )\n  )\n\n// 获取storage数据\n// function getStorageData() {\n//   chrome.storage.sync.get(\"collect\", (res) => {\n//     if (res.collect) {\n//       renderFavorite(res.collect)\n//       storageData = JSON.stringify(res.collect)\n     \n//     } else {\n//       chrome.storage.sync.set({ collect: [] })\n//     }\n//   })\n// }\n","import { getStorageData } from \"./store\"\n// 递归构造收藏的列表dom结构\nasync function createCollect(data) {\n  let storageData = await getStorageData('collect')\n  storageData = JSON.stringify(storageData)\n  let html = \"\"\n  if (!data.children) {\n    html += `<li class=\"bookmark-li\" data-url=\"${data.url}\" data-title=\"${data.title}\">`\n    html += `\n      <div class=\"bookmark-item\">\n        <div class=\"bookmark-item-bg\"></div>\n        <img class=\"iconTop\" data-url=\"${data.url}\" data-title=\"${\n      data.title\n    }\" src=\"${\n      storageData.search(data.url) === -1\n        ? \"./img/collect2.svg\"\n        : \"./img/collected2.svg\"\n    }\" />\n        <div class=\"bookmark-item-title\">\n            <img src=\"https://www.google.com/s2/favicons?domain=${\n              data.url\n            }\" alt=\"\" />\n            <p class=\"ellipsis\">${data.title}</p>\n          </div>\n          <p class=\"bookmark-item-url ellipsis\">\n            ${data.url}\n          </p>\n          <div class=\"bookmark-info\">\n            <p>${storageData.search(data.url) === -1 ? \"未收藏\" : \"已收藏\"}</p>\n            <img class=\"icon ${\n              storageData.search(data.url) === -1 ? \"collect-icon\" : \"\"\n            }\" data-url=\"${data.url}\" data-title=\"${data.title}\" src=\"${\n      storageData.search(data.url) === -1\n        ? \"./img/collect.svg\"\n        : \"./img/collected.svg\"\n    }\" />\n          </div>\n        </div>\n      </li>`\n    return html\n  }\n  html = `<div class=\"bookmark-folder\">\n  <div class=\"bookmark-header\">\n    <span class=\"btn-collapse btn-collapse--act\"></span>\n    <h3 class=\"bookmark-title\">${data.title}</h3>\n  </div>\n  <ul class=\"bookmark-ul\" style=\"display:none\">`\n  //先把无children的处理完\n  if (data.children.length) {\n    for (let item of data.children) {\n      if (!item.children) {\n        html += await createCollect(item)\n      }\n    }\n  } else {\n    html += `\n    <li class=\"no-data\">\n      <img src=\"./img/empty.svg\">\n      <p>暂无数据嗷，铁汁</p>\n    </li>`\n  }\n  html += `</ul></div>`\n  for (let item of data.children) {\n    if (item.children) {\n      html += await createCollect(item)\n    }\n  }\n  return html\n}\n\n// 构造我的最爱的dom结构\nfunction createFavorite(data) {\n  let html = `<div class=\"bookmark-folder\">\n  <div class=\"bookmark-header\">\n    <span class=\"btn-collapse\"></span>\n    <h3 class=\"bookmark-title\">收藏夹</h3>\n  </div>\n  <ul class=\"bookmark-ul\">`\n  if (data.length > 0) {\n    for (let item of data) {\n      html += `\n      <li class=\"bookmark-li\" data-url=\"${item.url}\">\n        <div class=\"bookmark-item\">\n          <div class=\"bookmark-item-bg\"></div>\n          <img class=\"iconTop\" src=\"./img/collected2.svg\" />\n          <!-- <img class=\"menu\" src=\"./img/menu.svg\" /> -->\n          <div class=\"bookmark-item-title\">\n            <img src=\"https://www.google.com/s2/favicons?domain=${item.url}\" alt=\"\" />\n            <p class=\"ellipsis\">${item.title}</p>\n          </div>\n          <p class=\"bookmark-item-url ellipsis\">\n            ${item.url}\n          </p>\n          <div class=\"bookmark-info\">\n            <p>已收藏</p>\n            <img class=\"icon del-icon\" data-url=\"${item.url}\" src=\"./img/del.svg\" />\n          </div>\n        </div>\n      </li>`\n    }\n  } else {\n    html += `\n    <li class=\"no-data\">\n      <img src=\"./img/empty.svg\">\n      <p>暂无数据嗷，铁汁</p>\n    </li>`\n  }\n  html += `</ul></div>`\n  let collectEl = document.getElementById(\"collect\")\n  collectEl.innerHTML = html\n}\n\n// 渲染我的最爱、置顶\nexport const renderFavorite = async () => {\n  let res = await getStorageData(\"collect\")\n  if (res.collect) {\n    createFavorite(res.collect)\n  } else {\n    chrome.storage.sync.set({ collect: [] })\n  }\n}\n\n// 渲染收藏列表\nexport const renderCollect = () =>\n  new Promise( (resolve, reject) => {\n    // content-script无权限获取目录，需要和background通信\n    chrome.runtime.sendMessage({}, async function (response) {\n      let data = JSON.parse(response)\n      let main = document.getElementById(\"bookmark\")\n      main.innerHTML = \"\"\n      let folderList = data[0].children\n      for (let item of folderList) {\n        main.innerHTML += await createCollect(item)\n      }\n      document.body.appendChild(main)\n      resolve()\n    })\n  })\n","import { renderFavorite, renderCollect } from \"./render\"\n// 收藏\nfunction handleCollect(e) {\n  const { url, title } = e.target.dataset\n  chrome.storage.sync.get(\"collect\", (res) => {\n    let data = JSON.parse(JSON.stringify(res.collect))\n    data.push({ url, title })\n    chrome.storage.sync.set({ collect: data })\n    renderFavorite() //重新渲染\n    renderCollect()\n    initBookmarkListener() //这里增加了dom，需要重新监听\n  })\n  e.stopPropagation()\n}\n// 删除收藏\nfunction handleDelCollect(e) {\n  const { url } = e.target.dataset\n  chrome.storage.sync.get(\"collect\", (res) => {\n    let data = JSON.parse(JSON.stringify(res.collect))\n    data.forEach((item, index) => {\n      if (item.url === url) {\n        data.splice(index, 1)\n      }\n    })\n    chrome.storage.sync.set({ collect: data })\n    renderFavorite() //重新渲染\n    renderCollect()\n  })\n  e.stopPropagation()\n}\n// 跳转\nfunction handleJump(e) {\n  let url = e.currentTarget.dataset.url\n  if (url) {\n    window.open(url, \"_blank\")\n  }\n}\n// 折叠\nfunction handleCollapse(e) {\n  let curFolder = e.currentTarget.parentNode\n  let curUl = curFolder.querySelector(\"ul\")\n  curUl.style.display = curUl.style.display == \"none\" ? \"flex\" : \"none\"\n  let icon = e.target.querySelector(\".btn-collapse\")\n  icon.classList.toggle(\"btn-collapse--act\")\n}\n\n// 搜索\nfunction search(e) {\n  if (e.which === 13) {\n    var obj = document.querySelectorAll(\".search-select\")[0]\n    var index = obj.selectedIndex\n    var value = obj.options[index].value\n    const inputValue = e.target.value\n    let url = \"\"\n    switch (value) {\n      case \"baidu\":\n        url = \"https://baidu.com/s?wd=\"\n        break\n      case \"google\":\n        url = \"https://www.google.com/search?q=\"\n        break\n      case \"bing\":\n        url = \"https://www.bing.com/search?q=\"\n        break\n      case \"sougou\":\n        url = \"https://www.sogou.com/web?query=\"\n        break\n    }\n    window.open(`${url}${inputValue}`, \"_blank\")\n  }\n}\n\nfunction switchTabTo(e) {\n  let { value } = e.currentTarget.dataset\n  switch (value) {\n    case \"light\":\n      switchMode(\"light\")\n      break\n    case \"dark\":\n      switchMode(\"dark\")\n      break\n    case \"auto\":\n      switchMode(\"auto\")\n      break\n  }\n}\n\n// 切换颜色模式\nfunction switchMode(modeData) {\n  chrome.storage.sync.set({ mode: modeData })\n  document.querySelector(\"body\").setAttribute(\"color-mode\", modeData)\n}\n\n// 注册全局监听器\nexport const initGlobalListener = function () {}\n\n//注册收藏列表相关监听器\nexport const initBookmarkListener = function () {\n  Array.from(document.querySelectorAll(\".bookmark-header\")).forEach((e) => {\n    e.addEventListener(\"click\", handleCollapse)\n  })\n  Array.from(document.querySelectorAll(\".bookmark-li\")).forEach((e) => {\n    e.addEventListener(\"click\", handleJump)\n  })\n  Array.from(document.querySelectorAll(\".collect-icon\")).forEach((e) => {\n    e.addEventListener(\"click\", handleCollect)\n  })\n  Array.from(document.querySelectorAll(\".del-icon\")).forEach((e) => {\n    e.addEventListener(\"click\", handleDelCollect)\n  })\n}\n\n//注册搜索栏相关监听器\nexport const initSearchListener = function () {\n  document.querySelector(\"input\").onkeypress = (e) => {\n    search(e)\n  }\n}\n\n//注册设置相关监听器\nexport const initSettingListener = function () {\n  Array.from(document.querySelectorAll(\".switch-tab\")).forEach((e) => {\n    e.addEventListener(\"click\", switchTabTo)\n  })\n  document.querySelector(\".form-item\").addEventListener(\"click\", (e) => {\n    document.querySelector(\".form-item\").classList.toggle(\"mode-open\")\n  })\n  Array.from(document.querySelectorAll(\".form-item svg\")).forEach((e) => {\n    e.addEventListener(\"click\", switchTabTo)\n  })\n}\n\n// 全部一起注册，冚家富贵\nexport const initAllListener = function () {\n  initGlobalListener()\n  initBookmarkListener()\n  initSearchListener()\n  initSettingListener()\n}\n","import { renderCollect, renderFavorite } from \"./render\"\nimport { initAllListener } from \"./event\"\n\n// 获取颜色模式\nfunction getModeData() {\n  chrome.storage.sync.get('mode',(res)=>{\n    const {mode} = res\n    console.log(mode)\n    switch (mode) {\n      case 'light':\n        break;\n      case 'dark':\n        break;\n      case 'auto':\n        break;\n      default:\n        break;\n    }\n    if(!mode) {\n      chrome.storage.sync.set({'mode': 'auto'})\n      mode = 'auto'\n    }\n    document.querySelector('body').setAttribute(\"color-mode\", mode)\n  })\n}\n\nasync function main() {\n  await renderCollect() //先渲染收藏列表\n  await renderFavorite() //再渲染我的最爱\n  initAllListener() //然后注册所有的事件监听器\n  getModeData()\n}\n\nmain()\n"],"sourceRoot":""}